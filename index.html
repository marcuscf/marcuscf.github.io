<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<style>
body {
  background-color: black;
  color: white;
  text-align: center;
}
h1 {
  font-size: 110pt;
  margin: 15px 0px 10px 0px;
}
h2 {
  margin: 10px 0px;
}
h3 {
  margin: 8px 0px;
}
</style>
<script>
  function enableFullScreen() {
    document.documentElement.requestFullscreen();
    wakeLock();
  }

  function wakeLock() {
    let statusElem = document.getElementById("status");

    if('wakeLock' in navigator) {
      //statusElem.textContent = 'Screen Wake Lock API supported!';
    } else {
      statusElem.textContent = 'Wake lock is not supported by this browser.';
    }

    let wakeLock = navigator.wakeLock.request('screen');
    wakeLock.then(() => {
      //statusElem.textContent = 'Wake Lock is active! ' + wakeLock;
    }).catch((err) => {
      statusElem.textContent = `${err.name}, ${err.message}`;
    });

    wakeLock.addEventListener('release', () => {
      // the wake lock has been released
      statusElem.textContent = 'Wake Lock has been released';
    });
  }
</script></head>
<body>
  <h1 id="hora">Olá</h1>
  <h2 id="data"></h2>
  <br>
  <h3 id="prevtempo1"></h3>
  <h3 id="prevtempo2"></h3>
  <button onclick="enableFullScreen();">Tela cheia</button><br>
  <small id="status"></small>
<script>
  function agora() {
    let dt = new Date();
    let h = dt.getHours();
    let mi = dt.getMinutes();
    h = (h < 10 ? "0" : "") + h;
    mi = (mi < 10 ? "0" : "") + mi;
    let d = dt.getDate();
    let me = dt.getMonth() + 1;
    let a = dt.getFullYear();
    d = (d < 10 ? "0" : "") + d;
    me = (me < 10 ? "0" : "") + me;
    return [h, mi, d, me, a];
  }
  
  let hora = document.getElementById('hora');
  let data = document.getElementById('data');
  
  function atualizaDataHora() {
    let [h, mi, d, me, a] = agora();
    hora.textContent = h + ':' + mi;
    data.textContent = d + '/' + me + '/' + a;
    return [h, mi, d, me, a];
  }
  
  let [h, mi, d, me, a] = atualizaDataHora();
  let lastMi = mi;
  
  let atualizaACadaSegundo = setInterval(() => {
    let [h, mi, d, me, a] = atualizaDataHora();
    if(lastMi != mi) {
      clearInterval(atualizaACadaSegundo);
      let atualizaACadaMinuto = setInterval(() => {
        let [h, mi, d, me, a] = atualizaDataHora();
      }, 60000);
    }
  }, 1000);
  
  const PORTO_ALEGRE = "5346";
  function iconToText(iconId) { // TODO: colocar os ícones também.
    switch(iconId) {
      case '1'  : return 'Sol';
      case '1n' : return 'Noite sem nuvens';
      case '2'  : return 'Sol com algumas nuvens';
      case '2r' : return 'Sol com muitas nuvens';
      case '2n' : return 'Noite com algumas nuvens';
      case '2rn': return 'Noite com muitas nuvens';
      case '3'  : return 'Nublado';
      case '3n' : return 'Nublado';
      case '4'  : return 'Sol e chuva';
      case '4r' : return 'Sol com muitas nuvens e chuva';
      case '4n' : return 'Noite chuvosa';
      case '4rn': return 'Noite nublada e chuvosa';
      case '4t' : return 'Sol entre nuvens e pancadas de chuva, com trovoadas';
      case '4tn': return 'Pancadas de chuva durante a noite';
      case '5'  : return 'Chuvoso';
      case '5n' : return 'Chuvoso';
      case '6'  : return 'Chuva e trovoadas';
      case '6n' : return 'Chuva e trovoadas';
      case '7'  : return 'Geada';
      case '7n' : return 'Geada';
      case '8'  : return 'Neve';
      case '9'  : return 'Nevoeiro';
      default   : return '';
    }
  }
  
  let climaTempoToken;
  if(location.href.indexOf('cttoken') < 0) {
    climaTempoToken = null;
  } else {
    climaTempoToken = location.href.replace(/^.*cttoken=(.*)$/, '$1');
  }
  function atualizarPrevTempo() {
    if(climaTempoToken != null && climaTempoToken.length > 20) {
      fetch("https://apiadvisor.climatempo.com.br/api/v1/weather/locale/" + PORTO_ALEGRE + "/current?token=" + climaTempoToken)
        .then((response) => {
          response.json().then((json) => {
            document.getElementById("prevtempo1").textContent = json.data.temperature + '°C' /*+ ' (sensação ' + json.data.sensation + '°C)'*/;
            document.getElementById("prevtempo2").textContent = iconToText(json.data.icon) + '. ' + json.data.condition + '. ';
          });
        });
    }
  }
  
  atualizarPrevTempo();
  setInterval(atualizarPrevTempo, 3600000);
</script></body></html>
